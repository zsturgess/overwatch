var overwatchApp=angular.module("overwatch",["ngRoute","angularModalService","ngIdle"]);overwatchApp.run(["$rootScope","$location","$routeParams",function(e,t,r){e.$on("$routeChangeSuccess",function(r,o,n){e.currentPage=t.path()})}]),overwatchApp.config(["$routeProvider","$httpProvider","IdleProvider",function(e,t,r){e.when("/",{title:"Dashboard",templateUrl:"partials/dashboard.html",controller:"DashboardController"}).when("/group/:id",{title:"Edit Group",templateUrl:"partials/editGroup.html",controller:"EditGroupController"}).when("/group/:id/add-test",{title:"Add test",templateUrl:"partials/testForm.html",controller:"AddTestController"}).when("/test/:id",{title:"View test",templateUrl:"partials/viewTest.html",controller:"ViewTestController"}).when("/test/:id/edit",{title:"Edit test",templateUrl:"partials/testForm.html",controller:"EditTestController"}).when("/users",{title:"Manage Users",templateUrl:"partials/manageUsers.html",controller:"ManageUsersController"}).when("/alerts",{title:"Change Alert Settings",templateUrl:"partials/changeAlertSettings.html",controller:"ManageAlertSettingsController"}).when("/my-account",{title:"My Account",templateUrl:"/profile/change-password",controller:"MyAccountController"}).when("/error",{title:"Error",templateUrl:"partials/error.html",controller:function(e,t){t.status={code:"500",text:"Internal Server Error"},e(!1)}}).otherwise({title:"Not Found",templateUrl:"partials/error.html",controller:function(e,t){t.status={code:"404",text:"Not Found"},e(!1)}}),t.interceptors.push("overwatchApiErrorHandler"),r.idle(300),r.timeout(5)}]),overwatchApp.factory("$gravatar",function(){return{fn:function(e,t){var r=function(e){function t(e,t){return e<<t|e>>>32-t}function r(e,t){var r,o,n,a,s;return n=2147483648&e,a=2147483648&t,r=1073741824&e,o=1073741824&t,s=(1073741823&e)+(1073741823&t),r&o?2147483648^s^n^a:r|o?1073741824&s?3221225472^s^n^a:1073741824^s^n^a:s^n^a}function o(e,t,r){return e&t|~e&r}function n(e,t,r){return e&r|t&~r}function a(e,t,r){return e^t^r}function s(e,t,r){return t^(e|~r)}function u(e,n,a,s,u,i,c){return e=r(e,r(r(o(n,a,s),u),c)),r(t(e,i),n)}function i(e,o,a,s,u,i,c){return e=r(e,r(r(n(o,a,s),u),c)),r(t(e,i),o)}function c(e,o,n,s,u,i,c){return e=r(e,r(r(a(o,n,s),u),c)),r(t(e,i),o)}function l(e,o,n,a,u,i,c){return e=r(e,r(r(s(o,n,a),u),c)),r(t(e,i),o)}function p(e){for(var t,r=e.length,o=r+8,n=(o-o%64)/64,a=16*(n+1),s=Array(a-1),u=0,i=0;r>i;)t=(i-i%4)/4,u=i%4*8,s[t]=s[t]|e.charCodeAt(i)<<u,i++;return t=(i-i%4)/4,u=i%4*8,s[t]=s[t]|128<<u,s[a-2]=r<<3,s[a-1]=r>>>29,s}function d(e){var t,r,o="",n="";for(r=0;3>=r;r++)t=e>>>8*r&255,n="0"+t.toString(16),o+=n.substr(n.length-2,2);return o}function f(e){e=e.replace(/rn/g,"n");for(var t="",r=0;r<e.length;r++){var o=e.charCodeAt(r);128>o?t+=String.fromCharCode(o):o>127&&2048>o?(t+=String.fromCharCode(o>>6|192),t+=String.fromCharCode(63&o|128)):(t+=String.fromCharCode(o>>12|224),t+=String.fromCharCode(o>>6&63|128),t+=String.fromCharCode(63&o|128))}return t}var h,g,m,v,w,_,A,$,y,R=Array(),U=7,S=12,C=17,E=22,T=5,M=9,b=14,N=20,P=4,L=11,x=16,D=23,I=6,G=10,O=15,F=21;for(e=f(e),R=p(e),_=1732584193,A=4023233417,$=2562383102,y=271733878,h=0;h<R.length;h+=16)g=_,m=A,v=$,w=y,_=u(_,A,$,y,R[h+0],U,3614090360),y=u(y,_,A,$,R[h+1],S,3905402710),$=u($,y,_,A,R[h+2],C,606105819),A=u(A,$,y,_,R[h+3],E,3250441966),_=u(_,A,$,y,R[h+4],U,4118548399),y=u(y,_,A,$,R[h+5],S,1200080426),$=u($,y,_,A,R[h+6],C,2821735955),A=u(A,$,y,_,R[h+7],E,4249261313),_=u(_,A,$,y,R[h+8],U,1770035416),y=u(y,_,A,$,R[h+9],S,2336552879),$=u($,y,_,A,R[h+10],C,4294925233),A=u(A,$,y,_,R[h+11],E,2304563134),_=u(_,A,$,y,R[h+12],U,1804603682),y=u(y,_,A,$,R[h+13],S,4254626195),$=u($,y,_,A,R[h+14],C,2792965006),A=u(A,$,y,_,R[h+15],E,1236535329),_=i(_,A,$,y,R[h+1],T,4129170786),y=i(y,_,A,$,R[h+6],M,3225465664),$=i($,y,_,A,R[h+11],b,643717713),A=i(A,$,y,_,R[h+0],N,3921069994),_=i(_,A,$,y,R[h+5],T,3593408605),y=i(y,_,A,$,R[h+10],M,38016083),$=i($,y,_,A,R[h+15],b,3634488961),A=i(A,$,y,_,R[h+4],N,3889429448),_=i(_,A,$,y,R[h+9],T,568446438),y=i(y,_,A,$,R[h+14],M,3275163606),$=i($,y,_,A,R[h+3],b,4107603335),A=i(A,$,y,_,R[h+8],N,1163531501),_=i(_,A,$,y,R[h+13],T,2850285829),y=i(y,_,A,$,R[h+2],M,4243563512),$=i($,y,_,A,R[h+7],b,1735328473),A=i(A,$,y,_,R[h+12],N,2368359562),_=c(_,A,$,y,R[h+5],P,4294588738),y=c(y,_,A,$,R[h+8],L,2272392833),$=c($,y,_,A,R[h+11],x,1839030562),A=c(A,$,y,_,R[h+14],D,4259657740),_=c(_,A,$,y,R[h+1],P,2763975236),y=c(y,_,A,$,R[h+4],L,1272893353),$=c($,y,_,A,R[h+7],x,4139469664),A=c(A,$,y,_,R[h+10],D,3200236656),_=c(_,A,$,y,R[h+13],P,681279174),y=c(y,_,A,$,R[h+0],L,3936430074),$=c($,y,_,A,R[h+3],x,3572445317),A=c(A,$,y,_,R[h+6],D,76029189),_=c(_,A,$,y,R[h+9],P,3654602809),y=c(y,_,A,$,R[h+12],L,3873151461),$=c($,y,_,A,R[h+15],x,530742520),A=c(A,$,y,_,R[h+2],D,3299628645),_=l(_,A,$,y,R[h+0],I,4096336452),y=l(y,_,A,$,R[h+7],G,1126891415),$=l($,y,_,A,R[h+14],O,2878612391),A=l(A,$,y,_,R[h+5],F,4237533241),_=l(_,A,$,y,R[h+12],I,1700485571),y=l(y,_,A,$,R[h+3],G,2399980690),$=l($,y,_,A,R[h+10],O,4293915773),A=l(A,$,y,_,R[h+1],F,2240044497),_=l(_,A,$,y,R[h+8],I,1873313359),y=l(y,_,A,$,R[h+15],G,4264355552),$=l($,y,_,A,R[h+6],O,2734768916),A=l(A,$,y,_,R[h+13],F,1309151649),_=l(_,A,$,y,R[h+4],I,4149444226),y=l(y,_,A,$,R[h+11],G,3174756917),$=l($,y,_,A,R[h+2],O,718787259),A=l(A,$,y,_,R[h+9],F,3951481745),_=r(_,g),A=r(A,m),$=r($,v),y=r(y,w);var H=d(_)+d(A)+d($)+d(y);return H.toLowerCase()};return scopesize=t||50,"//www.gravatar.com/avatar/"+r(e)+".jpg?s="+scopesize}}}),overwatchApp.controller("DashboardController",["showLoading","isGranted","$scope","overwatchApi","$window","$location","$interval",function(e,t,r,o,n,a,s){r.groups=[];var u=function(){o.get(Routing.generate("overwatch_test_testgroupapi_getallgroups")).success(function(t){r.groups=t,e(!1)})},i=s(u,6e4);r.$on("$destroy",function(){s.cancel(i)}),r.isGranted=function(e,r){return"undefined"==typeof r?t(e):t(e,r.name)},r.shouldWarnOfTestAge=function(){var e,t={total:0,count:0};return angular.forEach(r.groups,function(e){angular.forEach(e.tests,function(e){null!==e.result&&"undefined"!=typeof e.result.createdAt&&(this.total+=e.result.createdAt,this.count++)},this)},t),0===t.count?!1:(e=Date.now()/1e3-t.total/t.count,e>21600)},r.removeTest=function(t){n.confirm("Are you sure you want to remove this test? All historical data for this test will also be deleted.")&&(e(!0),o["delete"](Routing.generate("overwatch_test_testapi_deletetest",{id:t})).success(function(){u()}))},r.removeGroup=function(t){n.confirm("Are you sure you want to remove this group?")&&(e(!0),o["delete"](Routing.generate("overwatch_test_testgroupapi_deletegroup",{id:t})).success(function(){u()}))},r.createGroup=function(){var t=n.prompt("Please enter a name for the new group","Untitled Group");null!==t&&(e(!0),o.post(Routing.generate("overwatch_test_testgroupapi_creategroup"),{name:t}).success(function(){u()}))},r.runTest=function(t){e(!0),o.post(Routing.generate("overwatch_test_testapi_runtest",{id:t}),null).success(function(){a.path("/test/"+t)})},u()}]),overwatchApp.controller("EditGroupController",["showLoading","$scope","overwatchApi","$routeParams","$location","$window","$gravatar",function(e,t,r,o,n,a,s){t.group={};var u=function(){r.get(Routing.generate("overwatch_test_testgroupapi_getgroup",{id:o.id})).success(function(r){t.group=r,e(!1)})};t.userAvatar=function(e,t){return s.fn(e,t)},t.removeUser=function(o){a.confirm("Are you sure you want to remove this user from group '"+t.group.name+"'?")&&(e(!0),r["delete"](Routing.generate("overwatch_test_testgroupapi_removeuserfromgroup",{groupId:t.group.id,userId:o})).success(function(){u()}))},t.addUser=function(){var o=a.prompt("Please enter the e-mail address of the user you wish to add to group '"+t.group.name+"'",currentUser.email);null!==o&&(e(!0),r.get(Routing.generate("overwatch_user_api_finduser",{email:o})).success(function(e){r.post(Routing.generate("overwatch_test_testgroupapi_addusertogroup",{groupId:t.group.id,userId:e.id}),{}).success(function(){u()})}).error(function(){e(!1),a.alert("Could not find user by e-mail address '"+o+"'. Please ensure that they are already registered.")}))},t.renameGroup=function(){var o=a.prompt("Please type a new name for this group",t.group.name);null!==o&&o!==t.group.name&&(e(!0),r.put(Routing.generate("overwatch_test_testgroupapi_updategroup",{id:t.group.id}),{name:o}).success(function(r){t.group=r,currentUser.groups.push(r.name),e(!1)}))},u()}]),overwatchApp.controller("AddTestController",["showLoading","$scope","overwatchApi","$routeParams","$location",function(e,t,r,o,n){t.title="Add test",t.test={},t.expectations=[],r.get(Routing.generate("overwatch_expectation_api_getall")).success(function(r){t.expectations=r,e(!1)}),t.save=function(){e(!0),r.post(Routing.generate("overwatch_test_testapi_createtest",{id:o.id}),t.test).success(function(){n.path("/")})}}]),overwatchApp.controller("ViewTestController",["showLoading","isGranted","$scope","overwatchApi","$routeParams","$interval","$location","$window","$q",function(e,t,r,o,n,a,s,u,i){r.test={},r.test.results={},r.lastRequestedResultSize=0,r.loadResults=function(t){var a=o.get(Routing.generate("overwatch_test_testapi_gettest",{id:n.id})).success(function(e){var t=r.test.results;r.test=e,r.test.results=t}),s=o.get(Routing.generate("overwatch_result_api_getresultsfortest",{id:n.id})+"?pageSize="+t).success(function(e){r.test.results=e,r.lastRequestedResultSize=t});i.all([a,s]).then(function(){e(!1)})},r.loadOlderResults=function(){e(!0),r.loadResults(r.lastRequestedResultSize+10)},r.removeTest=function(t){u.confirm("Are you sure you want to remove this test? All historical data for this test will also be deleted.")&&(e(!0),o["delete"](Routing.generate("overwatch_test_testapi_deletetest",{id:t})).success(function(){s.path("/")}))},r.isGranted=function(e,r){return"undefined"==typeof r?t(e):t(e,r.name)},r.runTest=function(t){e(!0),o.post(Routing.generate("overwatch_test_testapi_runtest",{id:t}),null).success(function(){r.loadResults(r.lastRequestedResultSize)})},r.loadResults(10);var c=a(function(){r.loadResults(r.lastRequestedResultSize)},6e4);r.$on("$destroy",function(){a.cancel(c)})}]),overwatchApp.controller("EditTestController",["showLoading","$scope","overwatchApi","$routeParams","$location","$q",function(e,t,r,o,n,a){t.title="Edit test",t.test={},t.expectations=[];var s=r.get(Routing.generate("overwatch_expectation_api_getall")).success(function(e){t.expectations=e}),u=r.get(Routing.generate("overwatch_test_testapi_gettest",{id:o.id})).success(function(e){t.test=e});a.all([s,u]).then(function(){e(!1)}),t.save=function(){e(!0),r.put(Routing.generate("overwatch_test_testapi_updatetest",{id:o.id}),t.test).success(function(){n.path("/test/"+o.id)})}}]),overwatchApp.controller("ManageUsersController",["showLoading","$scope","overwatchApi","$window","ModalService","$gravatar",function(e,t,r,o,n,a){t.users=[],t.updatedRoles=[],t.currentUserId=currentUser.id;var s=function(){r.get(Routing.generate("overwatch_user_api_getallusers")).success(function(r){t.users=r,e(!1)})};t.createUser=function(){var t=o.prompt("Please type the new user's email address.","");null!==t&&(e(!0),r.post(Routing.generate("overwatch_user_api_createuser",{email:t}),{}).success(function(e){s()}))},t.userAvatar=function(e,t){return a.fn(e,t)},t.updateRole=function(t){n.showModal({templateUrl:"/partials/roleDialog.html",controller:"RoleDialogController"}).then(function(o){o.close.then(function(o){"CANCEL"!==o&&(e(!0),r.put(Routing.generate("overwatch_user_api_setuserrole",{id:t,role:o}),{}).success(function(){s()}))})})},t.lockUser=function(t){e(!0),r.put(Routing.generate("overwatch_user_api_togglelockuser",{id:t}),{}).success(function(){s()})},t.removeUser=function(t){o.confirm("Are you sure you want to permanently remove this user?")&&(e(!0),r["delete"](Routing.generate("overwatch_user_api_deleteuser",{id:t})).success(function(){s()}))},s()}]),overwatchApp.controller("ManageAlertSettingsController",["showLoading","$scope","overwatchApi",function(e,t,r){t.settings=[];var o=function(){r.get(Routing.generate("overwatch_user_api_getalertsettings")).success(function(r){t.settings=r,e(!1)})};t.isUsersSetting=function(e){return currentUser.alertSetting===e},t.saveSetting=function(t){e(!0),r.put(Routing.generate("overwatch_user_api_updateuser"),{alertSetting:t}).success(function(){currentUser.alertSetting=t,e(!1)})},o()}]),overwatchApp.controller("RoleDialogController",["$scope","close",function(e,t){e.close=function(e){t(e)}}]),overwatchApp.controller("MyAccountController",["showLoading","$scope","overwatchApi",function(e,t,r){t.telephoneNumber=currentUser.telephoneNumber,t.apiKeyFieldType="password",t.saveProfile=function(){e(!0),r.put(Routing.generate("overwatch_user_api_updateuser"),{telephoneNumber:t.telephoneNumber}).then(function(t){currentUser.telephoneNumber=t.data.telephoneNumber,e(!1)})["catch"](function(){e(!1),alert("Sorry, there was an error saving your telephone number.")})},t.toggleAPIKeyVisibility=function(){var e="password";"password"===t.apiKeyFieldType&&(e="text"),t.apiKeyFieldType=e},e(!1)}]),overwatchApp.run(["showLoading","$rootScope","$window","Idle",function(e,t,r,o){t.$on("$routeChangeStart",function(){e(!0)}),t.$on("$routeChangeSuccess",function(e,t){t.title?r.document.title=t.title+" - Overwatch":r.document.title="Overwatch"}),t.$on("IdleTimeout",function(){r.location.href="/logout"}),o.watch()}]),overwatchApp.factory("showLoading",["$rootScope",function(e){return function(t){e.isLoading=t}}]),overwatchApp.factory("isGranted",[function(){var e=function(t){return"ROLE_SUPER_ADMIN"!==t&&e("ROLE_SUPER_ADMIN")?!0:-1!==currentUser.roles.indexOf(t)},t=function(t){return e("ROLE_SUPER_ADMIN")?!0:-1!==currentUser.groups.indexOf(t)};return function(r,o){switch(r){case"SUPER_ADMIN":return e("ROLE_SUPER_ADMIN");case"ADMIN":return"undefined"==typeof o?e("ROLE_ADMIN"):e("ROLE_ADMIN")&&t(o);case"USER":return t(o);default:return!1}}}]),overwatchApp.factory("overwatchApiAuth",[function(){return{getHttpHeaders:function(){return{"X-Api-User":this.getUser(),"X-Api-Timestamp":this.getTimestamp(),"X-Api-Token":this.getToken()}},getToken:function(){return CryptoJS.HmacSHA256("timestamp="+this.getTimestamp(),currentUser.apiKey)},getUser:function(){return currentUser.id},getTimestamp:function(){return(new Date).getTime().toString().substr(0,10)}}}]),overwatchApp.service("overwatchApi",["overwatchApiAuth","$http",function(e,t){return{call:function(r){return r.hasOwnProperty("headers")?r.headers=angular.merge(r.headers,e.getHttpHeaders()):r.headers=e.getHttpHeaders(),t(r)},transformUrl:function(e){return 0!==e.indexOf("/api/")&&(e=Routing.generate(e)),e},get:function(e){return this.call({method:"GET",url:this.transformUrl(e)})},post:function(e,t){return this.call({method:"POST",data:t,url:this.transformUrl(e)})},put:function(e,t){return this.call({method:"PUT",data:t,url:this.transformUrl(e)})},"delete":function(e){return this.call({method:"DELETE",url:this.transformUrl(e)})}}}]),overwatchApp.factory("overwatchApiErrorHandler",["$location","$window",function(e,t){return{responseError:function(r){401===r.status||403===r.status?t.location.reload():e.url("/error")}}}]),overwatchApp.filter("ucfirst",[function(){return function(e,t){return e.replace(/(?:^|\s)\S/g,function(e){return e.toUpperCase()})}}]),overwatchApp.filter("strLimit",["$filter",function(e){return function(t,r){return t.length<=r?t:e("limitTo")(t,r)+"..."}}]),overwatchApp.filter("timeago",[function(){return function(e,t){var e=1e3*e;if(isNaN(e))return"never";var r,o=function(e,t,r){var o="function"==typeof e?e(t,i):e,n=r.numbers&&r.numbers[t]||t;return o.replace(/%d/i,n)},n=(new Date).getTime(),a=new Date(e).getTime(),s=t||!1,u={prefixAgo:null,prefixFromNow:null,suffixAgo:"ago",suffixFromNow:"from now",seconds:"less than a minute",minute:"about a minute",minutes:"%d minutes",hour:"about an hour",hours:"about %d hours",day:"a day",days:"%d days",month:"about a month",months:"%d months",year:"about a year",years:"%d years"},i=n-a,c=Math.abs(i)/1e3,l=c/60,p=l/60,d=p/24,f=d/365,h=void 0===u.wordSeparator?" ":u.wordSeparator,g=u.prefixAgo,m=u.suffixAgo;return s&&0>i&&(g=u.prefixFromNow,m=u.suffixFromNow),r=45>c&&o(u.seconds,Math.round(c),u)||90>c&&o(u.minute,1,u)||45>l&&o(u.minutes,Math.round(l),u)||90>l&&o(u.hour,1,u)||24>p&&o(u.hours,Math.round(p),u)||42>p&&o(u.day,1,u)||30>d&&o(u.days,Math.round(d),u)||45>d&&o(u.month,1,u)||365>d&&o(u.months,Math.round(d/30),u)||1.5>f&&o(u.year,1,u)||o(u.years,Math.round(f),u),[g,r,m].join(h).trim()}}]),!function(){"use strict";var e=angular.module("angularModalService",[]);e.factory("ModalService",["$document","$compile","$controller","$http","$rootScope","$q","$timeout","$templateCache",function(e,t,r,o,n,a,s,u){function i(){var e=this,i=function(e,t){var r=a.defer();if(e)r.resolve(e);else if(t){var n=u.get(t);void 0!==n?r.resolve(n):o({method:"GET",url:t,cache:!0}).then(function(e){u.put(t,e.data),r.resolve(e.data)})["catch"](function(e){r.reject(e)})}else r.reject("No template or templateUrl has been specified.");return r.promise};e.showModal=function(e){var o=a.defer(),u=e.controller;return u?(i(e.template,e.templateUrl).then(function(i){var l=n.$new(),p=a.defer(),d={$scope:l,close:function(e,t){(void 0===t||null===t)&&(t=0),s(function(){p.resolve(e)},t)}};if(e.inputs)for(var f in e.inputs)d[f]=e.inputs[f];var h=angular.element(i),g=t(h),m=g(l);d.$element=m;var v=r(u,d);e.appendElement?e.appendElement.append(m):c.append(m);var w={controller:v,scope:l,element:m,close:p.promise};w.close.then(function(){l.$destroy(),m.remove()}),o.resolve(w)})["catch"](function(e){o.reject(e)}),o.promise):(o.reject("No controller has been specified."),o.promise)}}var c=e.find("body");return new i}])}();